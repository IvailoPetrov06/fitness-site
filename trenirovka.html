<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <title>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ | FitnesSite</title>
  <link rel="stylesheet" href="./assets/css/style.css" />
</head>

<body>

<!-- üîí –ó–ê–©–ò–¢–ê -->
<script>
if (!localStorage.getItem("token")) {
  localStorage.setItem("redirect", "trenirovka.html");
  window.location.href = "register.html";
}
</script>

<header class="header">
  <div class="container">
    <a href="index.html" class="logo">
      <span class="span">FitnesSite</span>
    </a>

    <button onclick="logout()" class="btn btn-secondary">
      Logout
    </button>
  </div>
</header>

<main class="section">
  <div class="container">
    <h2 class="h2 section-title">–î–æ–±–∞–≤–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>

    <form id="workoutForm" class="form">
      <input type="text" id="workoutName" placeholder="–ò–º–µ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞" required />
      <input type="time" id="workoutTime" required />
      <input type="number" id="workoutDuration" placeholder="–ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç (–º–∏–Ω—É—Ç–∏)" required />
      <button type="submit" class="btn btn-primary">–ó–∞–ø–∞–∑–∏</button>
    </form>

    <h3 class="h3">–ú–æ–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h3>
    <ul id="workoutList"></ul>
  </div>
</main>

<script>
const API = "http://localhost:3000/api/workouts";
const list = document.getElementById("workoutList");
const form = document.getElementById("workoutForm");

async function loadWorkouts() {
  list.innerHTML = "";

  const res = await fetch(API, {
    headers: {
      Authorization: localStorage.getItem("token")
    }
  });

  const workouts = await res.json();

  workouts.forEach(w => {
    const li = document.createElement("li");
    li.textContent = `${w.name} ‚Äì ${w.time} ‚Äì ${w.duration} –º–∏–Ω `;

    const del = document.createElement("button");
    del.textContent = "–ò–∑—Ç—Ä–∏–π";
    del.className = "btn btn-secondary";

    del.onclick = async () => {
      await fetch(`${API}/${w.id}`, {
        method: "DELETE",
        headers: {
          Authorization: localStorage.getItem("token")
        }
      });
      loadWorkouts();
    };

    li.appendChild(del);
    list.appendChild(li);
  });
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("workoutName").value.trim();
  const time = document.getElementById("workoutTime").value;
  const duration = document.getElementById("workoutDuration").value;

  if (!name || !time || !duration) {
    alert("–í—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞ —Å–∞ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏");
    return;
  }

  await fetch(API, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: localStorage.getItem("token")
    },
    body: JSON.stringify({ name, time, duration })
  });

  form.reset();
  loadWorkouts();
});

loadWorkouts();
</script>

<!-- üîì LOGOUT -->
<script>
function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}
</script>

</body>
</html>
